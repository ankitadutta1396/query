{"version":3,"sources":["query.js"],"names":["$form","$","$submit","$spinner","$sql","$results","executing","on","ev","keyCode","Garnish","RETURN_KEY","isCtrlKeyPressed","submit","preventDefault","addClass","removeClass","Craft","postActionRequest","sql","val","response","textStatus","html","success","result","length","resultLabel","t","num","formattedTotal","key","i","cell","error"],"mappings":"AAAA,GAAIA,OAAQC,EAAE,eACVC,QAAUD,EAAE,iBACZE,SAAWF,EAAE,kBACbG,KAAOH,EAAE,cACTI,SAAWJ,EAAE,iBACbK,WAAY,CAEhBF,MAAKG,GAAG,UAAW,SAASC,GACrBA,EAAGC,UAAYC,QAAQC,YAAcD,QAAQE,iBAAiBJ,IAC9DR,MAAMa,WAIbb,MAAMO,GAAG,SAAU,SAASC,GACxBA,EAAGM,iBAECR,YAIJJ,QAAQa,SAAS,UACjBZ,SAASa,YAAY,UACrBV,WAAY,EAEZW,MAAMC,kBAAkB,yBAA0BC,IAAKf,KAAKgB,OAAQ,SAASC,EAAUC,GAKnF,GAJApB,QAAQc,YAAY,UACpBb,SAASY,SAAS,UAClBT,WAAY,EAEM,WAAdgB,EAAyB,CACzB,GAAIC,EAEJ,IAAIF,EAASG,SACT,GAAIH,EAASI,OAAOC,OAAQ,CACxB,GAAIC,GAAyC,IAA3BN,EAASI,OAAOC,OAC5BT,MAAMW,EAAE,QAAS,aACjBX,MAAMW,EAAE,QAAS,kBAAmBC,IAAKR,EAASS,gBAExDP,GAAO,MAAQI,EAAc,+CAK7B,KAAK,GAAII,KAAOV,GAASI,OAAO,GAC5BF,GAAQ,mBACJQ,EACA,OAGRR,IAAQ,uBAIR,KAAK,GAAIS,GAAI,EAAGA,EAAIX,EAASI,OAAOC,OAAQM,IAAK,CAC7CT,GAAQ,MACR,KAAK,GAAIU,KAAQZ,GAASI,OAAOO,GAC7BT,GAAQ,wCAEyB,OAA7BF,EAASI,OAAOO,GAAGC,GACnBV,GAAQ,uCAERA,GAAQF,EAASI,OAAOO,GAAGC,GAG/BV,GAAQ,aAEZA,IAAQ,QAGZA,GAAQ,uBAIZA,GAAO,oBAAsBF,EAASa,MAAQ,MAGlD7B,UAASkB,KAAKA","file":"query.min.js","sourcesContent":["var $form = $('#query-form');\nvar $submit = $('#query-submit');\nvar $spinner = $('#query-spinner');\nvar $sql = $('#query-sql');\nvar $results = $('#query-result');\nvar executing = false;\n\n$sql.on('keydown', function(ev) {\n   if (ev.keyCode === Garnish.RETURN_KEY && Garnish.isCtrlKeyPressed(ev)) {\n       $form.submit();\n   }\n});\n\n$form.on('submit', function(ev) {\n    ev.preventDefault();\n\n    if (executing) {\n        return;\n    }\n\n    $submit.addClass('active');\n    $spinner.removeClass('hidden');\n    executing = true;\n\n    Craft.postActionRequest('query/default/execute', {sql: $sql.val()}, function(response, textStatus) {\n        $submit.removeClass('active');\n        $spinner.addClass('hidden');\n        executing = false;\n\n        if (textStatus == 'success') {\n            var html;\n\n            if (response.success) {\n                if (response.result.length) {\n                    var resultLabel = response.result.length === 1\n                        ? Craft.t('query', '1 result:')\n                        : Craft.t('query', '{num} results:', {num: response.formattedTotal});\n\n                    html = '<p>' + resultLabel + '</p>' +\n                        '<table class=\"data fullwidth\">' +\n                        '<thead>' +\n                        '<tr>';\n\n                    for (var key in response.result[0]) {\n                        html += '<th scope=\"col\">' +\n                            key +\n                            '</th>';\n                    }\n\n                    html += '</tr>' +\n                        '</thead>' +\n                        '</tbody>';\n\n                    for (var i = 0; i < response.result.length; i++) {\n                        html += '<tr>';\n                        for (var cell in response.result[i]) {\n                            html += '<td style=\"vertical-align: top\"><pre>';\n\n                            if (response.result[i][cell] === null) {\n                                html += '<span class=\"extralight\">NULL</span>';\n                            } else {\n                                html += response.result[i][cell];\n                            }\n\n                            html += '</pre></td>';\n                        }\n                        html += '</tr>';\n                    }\n\n                    html += '<tbody>' +\n                        '</table>';\n                }\n            } else {\n                html = '<p class=\"error\">' + response.error + '</p>'\n            }\n\n            $results.html(html);\n        }\n    });\n});\n"]}